-- Hilton | Arm Lock (AnimationIntercept + Transform + FrameClamp)
-- Run once to lock, run again to unlock
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local G = getgenv and getgenv() or _G
G.__ArmLock = G.__ArmLock or { active=false, conns={}, joints={} }

local function cleanup()
    for _,c in ipairs(G.__ArmLock.conns) do pcall(function() c:Disconnect() end) end
    for _,m in pairs(G.__ArmLock.joints) do pcall(function() m.Transform = CFrame.new() end) end
    table.clear(G.__ArmLock.conns)
    table.clear(G.__ArmLock.joints)
    G.__ArmLock.active=false
end

if G.__ArmLock.active then
    cleanup()
    warn("[ArmLock] Released pose and cleaned up.")
    return
end

G.__ArmLock.active=true

local char = Players.LocalPlayer.Character or Players.LocalPlayer.CharacterAdded:Wait()
local hum = char:WaitForChild("Humanoid")

-- Get shoulder joint (R15 or R6)
local joints = {}
do
    local rua = char:FindFirstChild("RightUpperArm")
    if rua then
        local sh = rua:FindFirstChild("RightShoulder") or char:FindFirstChild("UpperTorso"):FindFirstChild("RightShoulder")
        if sh then joints.s = sh end
    else
        local torso = char:FindFirstChild("Torso")
        if torso then
            local shR6 = torso:FindFirstChild("Right Shoulder")
            if shR6 then joints.s = shR6 end
        end
    end
end
G.__ArmLock.joints = joints

local SHOULDER_ANG = CFrame.Angles(math.rad(-70),0,0)

-- Kill any current tracks on spawn
for _,track in ipairs(hum:GetPlayingAnimationTracks()) do
    track:Stop(0)
end

-- Stop *new* animations targeting the arm
G.__ArmLock.conns[#G.__ArmLock.conns+1] = hum.AnimationPlayed:Connect(function(track)
    -- Optional: inspect track.Animation.AnimationId here if you want to filter
    pcall(function() track:Stop(0) end)
end)

-- Re‑apply transform every frame
G.__ArmLock.conns[#G.__ArmLock.conns+1] = RunService.RenderStepped:Connect(function()
    if joints.s then
        joints.s.Transform = SHOULDER_ANG
    end
end)

-- Re‑lock on respawn
G.__ArmLock.conns[#G.__ArmLock.conns+1] = Players.LocalPlayer.CharacterAdded:Connect(function(newChar)
    cleanup()
    wait(0.5)
    -- re‑exec the script here if you want persistence
end)

warn("[ArmLock] Applied. Limb should now stay locked until script is re‑exec'ed to unlock.")
