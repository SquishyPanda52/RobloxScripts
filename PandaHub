-- Panda Fly Final (Local Only)
local Players=game:GetService("Players")
local UIS=game:GetService("UserInputService")
local RS=game:GetService("RunService")
local LP=Players.LocalPlayer
local PG=LP:FindFirstChildOfClass("PlayerGui") or LP:WaitForChild("PlayerGui")
local ASSETS={Logo="rbxassetid://140281572489473",Phone="rbxassetid://75163729493008",PC="rbxassetid://75277585107743"}
local SPEED_MIN,SPEED_MAX=8,300
local speedVal=nil
local flying=false
local bg,bv
local conns={}

local function cleanupFly()
	flying=false
	if bg then bg:Destroy() bg=nil end
	if bv then bv:Destroy() bv=nil end
end

local function startFly()
	local char=LP.Character or LP.CharacterAdded:Wait()
	local hrp=char:WaitForChild("HumanoidRootPart")
	local hum=char:FindFirstChildOfClass("Humanoid")
	bg=Instance.new("BodyGyro");bg.P=9e4;bg.MaxTorque=Vector3.new(9e9,9e9,9e9);bg.CFrame=hrp.CFrame;bg.Parent=hrp
	bv=Instance.new("BodyVelocity");bv.MaxForce=Vector3.new(9e9,9e9,9e9);bv.Velocity=Vector3.zero;bv.Parent=hrp
	if hum and speedVal then hum.WalkSpeed=speedVal end
	conns[#conns+1]=RS.RenderStepped:Connect(function()
		if flying and hrp then
			bg.CFrame=workspace.CurrentCamera.CFrame
			bv.Velocity=workspace.CurrentCamera.CFrame.LookVector*(speedVal or 0)
		end
	end)
end

local function stopFly()
	for _,c in ipairs(conns) do if c.Connected then c:Disconnect() end end
	table.clear(conns)
	cleanupFly()
end

local function toggleFly()
	flying=not flying
	if flying then startFly() else stopFly() end
end

local function makeBtn(txt,size,pos,parent,color)
	local b=Instance.new("TextButton")
	b.Size=size;b.Position=pos;b.Text=txt
	b.BackgroundColor3=color or Color3.fromRGB(24,24,28)
	b.TextColor3=Color3.new(1,1,1)
	b.Font=Enum.Font.GothamBold;b.TextSize=16;b.AutoButtonColor=true
	b.Parent=parent
	return b
end

local function makeSpeedBox(parent)
	local tb=Instance.new("TextBox")
	tb.Size=UDim2.new(0,80,0,28)
	tb.PlaceholderText="---"
	tb.Text=(speedVal and tostring(speedVal) or "")
	tb.BackgroundColor3=Color3.fromRGB(16,16,18)
	tb.TextColor3=Color3.new(1,1,1)
	tb.Font=Enum.Font.GothamSemibold;tb.TextSize=16
	tb.ClearTextOnFocus=false
	tb.Parent=parent
	tb.FocusLost:Connect(function()
		local num=tonumber(tb.Text)
		if num then
			speedVal=math.clamp(math.floor(num+0.5),SPEED_MIN,SPEED_MAX)
			tb.Text=tostring(speedVal)
		else
			tb.Text=speedVal and tostring(speedVal) or ""
		end
	end)
	return tb
end

local function deviceSelect()
	local gui=Instance.new("ScreenGui",PG)
	gui.Name="PandaFlyUI";gui.ResetOnSpawn=false
	local frame=Instance.new("Frame",gui)
	frame.AnchorPoint=Vector2.new(0.5,0.5);frame.Position=UDim2.new(0.5,0,0.5,0)
	frame.Size=UDim2.new(0,300,0,200)
	frame.BackgroundColor3=Color3.fromRGB(24,24,28)

	local logo=Instance.new("ImageLabel",frame)
	logo.Image=ASSETS.Logo;logo.BackgroundTransparency=1
	logo.Size=UDim2.new(0,72,0,72);logo.Position=UDim2.new(0.5,-36,0,10)

	local phoneB=makeBtn("Phone",UDim2.new(0,120,0,40),UDim2.new(0.25,-60,0.7,-20),frame)
	local pcB=makeBtn("PC",UDim2.new(0,120,0,40),UDim2.new(0.75,-60,0.7,-20),frame)

	phoneB.MouseButton1Click:Connect(function() gui:Destroy();mainUI("Phone") end)
	pcB.MouseButton1Click:Connect(function() gui:Destroy();mainUI("PC") end)
end

function mainUI(mode)
	local gui=Instance.new("ScreenGui",PG)
	gui.Name="PandaFlyMain";gui.ResetOnSpawn=false
	local frame=Instance.new("Frame",gui)
	frame.AnchorPoint=Vector2.new(0,1);frame.Position=UDim2.new(0,20,1,-20)
	frame.Size=UDim2.new(0,260,0,100)
	frame.BackgroundColor3=Color3.fromRGB(24,24,28)

	local logo=Instance.new("ImageLabel",frame)
	logo.Image=ASSETS.Logo;logo.BackgroundTransparency=1
	logo.Size=UDim2.new(0,40,0,40);logo.Position=UDim2.new(0,10,0,10)

	local close=makeBtn("X",UDim2.new(0,30,0,30),UDim2.new(1,-40,0,10),frame,Color3.fromRGB(200,50,50))
	close.MouseButton1Click:Connect(function() stopFly();gui:Destroy() end)

	if mode=="PC" then
		local toggleB=makeBtn("Fly: OFF (E can also toggle)",UDim2.new(0,200,0,30),UDim2.new(0,10,0,50),frame,Color3.fromRGB(0,170,255))
		toggleB.MouseButton1Click:Connect(function()
			toggleFly()
			toggleB.Text=flying and "Fly: ON (E can also toggle)" or "Fly: OFF (E can also toggle)"
			toggleB.BackgroundColor3=flying and Color3.fromRGB(0,200,100) or Color3.fromRGB(0,170,255)
		end)
		UIS.InputBegan:Connect(function(i,gpe) if not gpe and i.KeyCode==Enum.KeyCode.E then toggleB:Activate() end end)
		makeSpeedBox(frame)
	else
		local toggleB=makeBtn("Fly: OFF",UDim2.new(0,100,0,30),UDim2.new(0,10,0,50),frame,Color3.fromRGB(0,170,255))
		toggleB.MouseButton1Click:Connect(function()
			toggleFly()
			toggleB.Text=flying and "Fly: ON" or "Fly: OFF"
			toggleB.BackgroundColor3=flying and Color3.fromRGB(0,200,100) or Color3.fromRGB(0,170,255)
		end)
		makeSpeedBox(frame)
	end
end

deviceSelect()
